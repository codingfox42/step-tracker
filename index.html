<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ­¥æ•°ç»Ÿè®¡</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="app-container">
        <header>
            <h1>æ­¥æ•°ç»Ÿè®¡</h1>
            <div class="user-info">
                <span id="username">User</span>
                <button id="logout-btn" class="icon-btn">ğŸšª</button>
            </div>
        </header>

        <div class="input-section">
            <h2>ä»Šæ—¥æ­¥æ•°</h2>
            <div class="step-input">
                <input type="number" id="step-count" placeholder="è¾“å…¥æ­¥æ•°">
                <button id="submit-steps">æ›´æ–°</button>
            </div>
        </div>

        <div class="stats-section">
            <h2>å°ç»„æ•°æ®</h2>
            <div class="tab-container">
                <button class="tab-btn active" data-tab="daily">ä»Šæ—¥æ’å</button>
                <button class="tab-btn" data-tab="weekly">å‘¨æ•°æ®</button>
                <button class="tab-btn" data-tab="monthly">æœˆå‡å€¼</button>
            </div>
            
            <div class="tab-content active" id="daily">
                <div class="ranking-container">
                    <!-- Ranking will be populated by JS -->
                </div>
            </div>
            
            <div class="tab-content" id="weekly">
                <div class="chart-container">
                    <canvas id="weekly-chart"></canvas>
                </div>
            </div>
            
            <div class="tab-content" id="monthly">
                <div class="chart-container">
                    <canvas id="monthly-chart"></canvas>
                </div>
            </div>
        </div>

        <!-- Removed group members section as requested -->
    </div>

    <!-- Login Modal -->
    <div class="modal" id="login-modal">
        <div class="modal-content">
            <h2>ç™»å½• / æ³¨å†Œ</h2>
            <input type="text" id="login-username" placeholder="ç”¨æˆ·å">
            <input type="password" id="login-password" placeholder="å¯†ç ">
            <div class="modal-buttons">
                <button id="login-btn">ç™»å½•</button>
                <button id="register-btn">æ³¨å†Œ</button>
            </div>
        </div>
    </div>

    <!-- Group Modal -->
    <div class="modal" id="group-modal">
        <div class="modal-content">
            <h2>åŠ å…¥æˆ–åˆ›å»ºå°ç»„</h2>
            <input type="text" id="group-code" placeholder="è¾“å…¥å°ç»„ä»£ç ">
            <div class="modal-buttons">
                <button id="join-group-btn">åŠ å…¥å°ç»„</button>
                <button id="create-group-btn">åˆ›å»ºæ–°å°ç»„</button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK with error handling -->
    <script>
        // Create a global error handler for script loading
        window.addEventListener('error', function(e) {
            if (e.target && e.target.tagName === 'SCRIPT') {
                console.error('Script loading error:', e.target.src);
                alert('åŠ è½½Firebase SDKå¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥å¹¶åˆ·æ–°é¡µé¢ã€‚');
            }
        }, true);
    </script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <!-- Chart.js and plugins -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@2.1.0/dist/chartjs-plugin-annotation.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
    <script>
        // Register the plugins
        document.addEventListener('DOMContentLoaded', function() {
            try {
                // Make sure Chart is available
                if (typeof Chart !== 'undefined') {
                    // Register ChartDataLabels if available
                    if (typeof ChartDataLabels !== 'undefined') {
                        Chart.register(ChartDataLabels);
                        console.log("ChartDataLabels plugin registered");
                    } else {
                        console.warn("ChartDataLabels plugin not found");
                    }
                    
                    // Register ChartAnnotation if available
                    if (typeof ChartAnnotation !== 'undefined') {
                        Chart.register(ChartAnnotation);
                        console.log("ChartAnnotation plugin registered");
                    } else {
                        console.warn("ChartAnnotation plugin not found");
                    }
                    
                    console.log("Chart.js plugins registration completed");
                } else {
                    console.error("Chart.js not loaded");
                    alert("å›¾è¡¨åº“åŠ è½½å¤±è´¥ï¼Œéƒ¨åˆ†åŠŸèƒ½å¯èƒ½æ— æ³•æ­£å¸¸å·¥ä½œã€‚");
                }
            } catch (error) {
                console.error("Error registering plugins:", error);
            }
        });
    </script>
    <script>
        // Add a fallback mechanism to ensure login modal shows up
        window.addEventListener('load', function() {
            setTimeout(function() {
                // Check if login modal is visible
                const loginModal = document.getElementById('login-modal');
                if (loginModal && !loginModal.classList.contains('active')) {
                    console.log("Forcing login modal to show");
                    loginModal.classList.add('active');
                    
                    // Add direct event listeners to buttons as a fallback
                    const loginBtn = document.getElementById('login-btn');
                    const registerBtn = document.getElementById('register-btn');
                    
                    if (loginBtn && !loginBtn.onclick) {
                        loginBtn.onclick = function() {
                            const username = document.getElementById('login-username').value;
                            const password = document.getElementById('login-password').value;
                            console.log("Login attempt with:", username);
                            
                            // Simple validation
                            if (username && password) {
                                document.getElementById('username').textContent = username;
                                loginModal.classList.remove('active');
                            } else {
                                alert('è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ');
                            }
                        };
                    }
                    
                    if (registerBtn && !registerBtn.onclick) {
                        registerBtn.onclick = function() {
                            const username = document.getElementById('login-username').value;
                            const password = document.getElementById('login-password').value;
                            
                            if (username && password) {
                                document.getElementById('username').textContent = username;
                                loginModal.classList.remove('active');
                                alert('æ³¨å†ŒæˆåŠŸï¼');
                            } else {
                                alert('è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ');
                            }
                        };
                    }
                }
            }, 1000); // Wait 1 second to ensure everything has loaded
        });
    </script>
    <script src="app.js"></script>
</body>
</html>