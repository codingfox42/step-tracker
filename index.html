<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ê≠•Êï∞ÁªüËÆ°</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="app-container">
        <header>
            <h1>Ê≠•Êï∞ÁªüËÆ°</h1>
            <div class="user-info">
                <span id="username">User</span>
                <button id="logout-btn" class="icon-btn">üö™</button>
            </div>
        </header>

        <div class="input-section">
            <h2>‰ªäÊó•Ê≠•Êï∞</h2>
            <div class="step-input">
                <input type="number" id="step-count" placeholder="ËæìÂÖ•Ê≠•Êï∞">
                <button id="submit-steps">Êõ¥Êñ∞</button>
            </div>
        </div>

        <div class="stats-section">
            <h2>Â∞èÁªÑÊï∞ÊçÆ</h2>
            <div class="tab-container">
                <button class="tab-btn active" data-tab="daily">‰ªäÊó•ÊéíÂêç</button>
                <button class="tab-btn" data-tab="weekly">Âë®Êï∞ÊçÆ</button>
                <button class="tab-btn" data-tab="monthly">ÊúàÂùáÂÄº</button>
            </div>
            
            <div class="tab-content active" id="daily">
                <div class="ranking-container">
                    <!-- Ranking will be populated by JS -->
                </div>
            </div>
            
            <div class="tab-content" id="weekly">
                <div class="chart-container">
                    <canvas id="weekly-chart"></canvas>
                </div>
            </div>
            
            <div class="tab-content" id="monthly">
                <div class="chart-container">
                    <canvas id="monthly-chart"></canvas>
                </div>
            </div>
        </div>

        <!-- Removed group members section as requested -->
    </div>

    <!-- Login Modal -->
    <div class="modal" id="login-modal">
        <div class="modal-content">
            <h2>ÁôªÂΩï / Ê≥®ÂÜå</h2>
            <input type="text" id="login-username" placeholder="Áî®Êà∑Âêç">
            <input type="password" id="login-password" placeholder="ÂØÜÁ†Å">
            <div class="modal-buttons">
                <button id="login-btn">ÁôªÂΩï</button>
                <button id="register-btn">Ê≥®ÂÜå</button>
            </div>
        </div>
    </div>

    <!-- Group Modal -->
    <div class="modal" id="group-modal">
        <div class="modal-content">
            <h2>Âä†ÂÖ•ÊàñÂàõÂª∫Â∞èÁªÑ</h2>
            <input type="text" id="group-code" placeholder="ËæìÂÖ•Â∞èÁªÑ‰ª£Á†Å">
            <div class="modal-buttons">
                <button id="join-group-btn">Âä†ÂÖ•Â∞èÁªÑ</button>
                <button id="create-group-btn">ÂàõÂª∫Êñ∞Â∞èÁªÑ</button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK with error handling -->
    <script>
        // Create a global error handler for script loading
        window.addEventListener('error', function(e) {
            if (e.target && e.target.tagName === 'SCRIPT') {
                console.error('Script loading error:', e.target.src);
                // Don't show alert, just log the error
            }
        }, true);
        
        // Create a global firebase object with fallback methods
        window.firebase = window.firebase || {
            initializeApp: function() {
                console.log("Using Firebase fallback implementation");
                return {};
            },
            database: function() {
                return {
                    ref: function() {
                        return {
                            once: function() {
                                return Promise.resolve({
                                    val: function() { return []; },
                                    exists: function() { return false; }
                                });
                            },
                            on: function(event, callback) {
                                setTimeout(function() {
                                    callback({
                                        val: function() { return []; }
                                    });
                                }, 100);
                            },
                            set: function() {
                                return Promise.resolve();
                            }
                        };
                    }
                };
            }
        };
    </script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <!-- Chart.js and plugins -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@2.1.0/dist/chartjs-plugin-annotation.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
    <script>
        // Register the plugins and add direct event listeners
        document.addEventListener('DOMContentLoaded', function() {
            console.log("DOM Content Loaded");
            
            // Register Chart.js plugins
            try {
                // Make sure Chart is available
                if (typeof Chart !== 'undefined') {
                    // Register ChartDataLabels if available
                    if (typeof ChartDataLabels !== 'undefined') {
                        Chart.register(ChartDataLabels);
                        console.log("ChartDataLabels plugin registered");
                    } else {
                        console.warn("ChartDataLabels plugin not found");
                    }
                    
                    // Register ChartAnnotation if available
                    if (typeof ChartAnnotation !== 'undefined') {
                        Chart.register(ChartAnnotation);
                        console.log("ChartAnnotation plugin registered");
                    } else {
                        console.warn("ChartAnnotation plugin not found");
                    }
                    
                    console.log("Chart.js plugins registration completed");
                } else {
                    console.error("Chart.js not loaded");
                }
            } catch (error) {
                console.error("Error registering plugins:", error);
            }
            
            // Add direct event listeners to critical elements
            try {
                // Tab buttons
                document.querySelectorAll('.tab-btn').forEach(function(button) {
                    button.addEventListener('click', function() {
                        console.log("Tab clicked:", this.dataset.tab);
                        
                        // Remove active class from all tabs
                        document.querySelectorAll('.tab-btn').forEach(function(btn) {
                            btn.classList.remove('active');
                        });
                        
                        // Add active class to clicked tab
                        this.classList.add('active');
                        
                        // Hide all tab contents
                        document.querySelectorAll('.tab-content').forEach(function(content) {
                            content.classList.remove('active');
                        });
                        
                        // Show selected tab content
                        const tabId = this.dataset.tab;
                        const tabContent = document.getElementById(tabId);
                        if (tabContent) {
                            tabContent.classList.add('active');
                        }
                    });
                    console.log("Added click listener to tab:", button.dataset.tab);
                });
                
                // Login button
                const loginBtn = document.getElementById('login-btn');
                if (loginBtn) {
                    loginBtn.addEventListener('click', function() {
                        console.log("Login button clicked");
                        const username = document.getElementById('login-username').value;
                        const password = document.getElementById('login-password').value;
                        
                        if (!username || !password) {
                            alert('ËØ∑ËæìÂÖ•Áî®Êà∑ÂêçÂíåÂØÜÁ†Å');
                            return;
                        }
                        
                        // The actual login logic is in app.js
                    });
                }
                
                // Register button
                const registerBtn = document.getElementById('register-btn');
                if (registerBtn) {
                    registerBtn.addEventListener('click', function() {
                        console.log("Register button clicked");
                        const username = document.getElementById('login-username').value;
                        const password = document.getElementById('login-password').value;
                        
                        if (!username || !password) {
                            alert('ËØ∑ËæìÂÖ•Áî®Êà∑ÂêçÂíåÂØÜÁ†Å');
                            return;
                        }
                        
                        // The actual register logic is in app.js
                    });
                }
                
                // Submit steps button
                const submitStepsBtn = document.getElementById('submit-steps');
                if (submitStepsBtn) {
                    submitStepsBtn.addEventListener('click', function() {
                        console.log("Submit steps button clicked");
                        const steps = document.getElementById('step-count').value;
                        
                        if (!steps || isNaN(parseInt(steps)) || parseInt(steps) < 0) {
                            alert('ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑÊ≠•Êï∞');
                            return;
                        }
                        
                        // The actual submit logic is in app.js
                    });
                }
                
                // Logout button
                const logoutBtn = document.getElementById('logout-btn');
                if (logoutBtn) {
                    logoutBtn.addEventListener('click', function() {
                        console.log("Logout button clicked");
                        document.getElementById('username').textContent = 'User';
                        document.getElementById('login-modal').classList.add('active');
                        
                        // The actual logout logic is in app.js
                    });
                }
                
                console.log("All direct event listeners added successfully");
            } catch (error) {
                console.error("Error adding direct event listeners:", error);
            }
        });
    </script>
    <script>
        // Add a fallback mechanism to ensure login modal shows up
        window.addEventListener('load', function() {
            setTimeout(function() {
                // Check if login modal is visible
                const loginModal = document.getElementById('login-modal');
                if (loginModal && !loginModal.classList.contains('active')) {
                    console.log("Forcing login modal to show");
                    loginModal.classList.add('active');
                    
                    // Add direct event listeners to buttons as a fallback
                    const loginBtn = document.getElementById('login-btn');
                    const registerBtn = document.getElementById('register-btn');
                    
                    if (loginBtn && !loginBtn.onclick) {
                        loginBtn.onclick = function() {
                            const username = document.getElementById('login-username').value;
                            const password = document.getElementById('login-password').value;
                            console.log("Login attempt with:", username);
                            
                            // Simple validation
                            if (username && password) {
                                document.getElementById('username').textContent = username;
                                loginModal.classList.remove('active');
                            } else {
                                alert('ËØ∑ËæìÂÖ•Áî®Êà∑ÂêçÂíåÂØÜÁ†Å');
                            }
                        };
                    }
                    
                    if (registerBtn && !registerBtn.onclick) {
                        registerBtn.onclick = function() {
                            const username = document.getElementById('login-username').value;
                            const password = document.getElementById('login-password').value;
                            
                            if (username && password) {
                                document.getElementById('username').textContent = username;
                                loginModal.classList.remove('active');
                                alert('Ê≥®ÂÜåÊàêÂäüÔºÅ');
                            } else {
                                alert('ËØ∑ËæìÂÖ•Áî®Êà∑ÂêçÂíåÂØÜÁ†Å');
                            }
                        };
                    }
                }
            }, 1000); // Wait 1 second to ensure everything has loaded
        });
    </script>
    <script src="app.js"></script>
</body>
</html>